<!DOCTYPE html>
<html lang="en">
<head>
  <title>Guild Inspector</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
  <style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  }
  </style>   
</head>
<body>
    <script>
        var YOUR_CLIENT_ID = 'a6b221902569443483e1c70f7330a0ae';
        var YOUR_REDIRECT_URI = 'https://steven-fuller.github.io';
        var fragmentString = location.hash.substring(1);
      
        // Parse query string to see if page request is coming from OAuth 2.0 server.
        var params = {};
        var regex = /([^&=]+)=([^&]*)/g, m;
        while (m = regex.exec(fragmentString)) {
          params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }
        if (Object.keys(params).length > 0) {
          localStorage.setItem('oauth2-test-params', JSON.stringify(params) );
          if (params['state'] && params['state'] == 'try_sample_request') {
            trySampleRequest();
          }
        }
      
        // If there's an access token, try an API request.
        // Otherwise, start OAuth 2.0 flow.
        function trySampleRequest() {
          var params = JSON.parse(localStorage.getItem('oauth2-test-params'));
          if (params && params['access_token']) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET',
                'https://us.api.blizzard.com/wow/guild/Proudmoore/Aspect of Disunity?fields=members&locale=en_US&' +
                'access_token=' + params['access_token']);
            xhr.onreadystatechange = function (e) {
              if (xhr.readyState === 4 && xhr.status === 200) {
                console.log(xhr.response);
              } else if (xhr.readyState === 4 && xhr.status === 401) {
                // Token invalid, so prompt for user permission.
                oauth2SignIn();
              }
            };
            xhr.send(null);
          } else {
            oauth2SignIn();
          }
        }
      
        /*
         * Create form to request access token from Blizzard's OAuth 2.0 server.
         */
        function oauth2SignIn() {
          // Blizzard's OAuth 2.0 endpoint for requesting an access token
          var oauth2Endpoint = 'https://us.battle.net/oauth/token';
      
          // Create element to open OAuth 2.0 endpoint in new window.
          var form = document.createElement('form');
          form.setAttribute('method', 'GET'); // Send as a GET request.
          form.setAttribute('action', oauth2Endpoint);
      
          // Parameters to pass to OAuth 2.0 endpoint.
          var params = {'client_id': 'a6b221902569443483e1c70f7330a0ae',
                        'redirect_uri': 'https://steven-fuller.github.io',
                        'scope': 'public',
                        'state': 'try_sample_request',
                        'include_granted_scopes': 'true',
                        'response_type': 'token'};
      
          // Add form parameters as hidden input values.
          for (var p in params) {
            var input = document.createElement('input');
            input.setAttribute('type', 'hidden');
            input.setAttribute('name', p);
            input.setAttribute('value', params[p]);
            form.appendChild(input);
          }
      
          // Add form to page and submit it to open the OAuth 2.0 endpoint.
          document.body.appendChild(form);
          form.submit();
        }
      </script>
<button onclick="trySampleRequest();">Try sample request</button>

<div class="jumbotron text-center" style="margin-bottom:0">
  <h1>Guild Inspector</h1>
</div>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <a class="navbar-brand" href="#">Welcome</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>    
    </ul>
  </div>  
</nav>

<form action="getAPIToken()">
  <label for="clientid">Client ID</label>
  <input type="text" id="clientid" name="client_id" placeholder="Client ID...">

  <label for="clientsecret">Client Secret</label>
  <input type="text" id="clientsecret" name="client_secret" placeholder="Client Secret...">

  <input type="submit" value="Submit">
</form>

<div class="jumbotron text-center" style="margin-bottom:0">
  <p>Copyright 2019 Steve Fuller</p>
</div>

</body>
</html>